@using ObjectInfos;
@using BussinessFacade;
@{
    //decimal _application_header_id = -1;
    //if (ViewBag.Application_Header_Id != null)
    //{
    //    _application_header_id = ViewBag.Application_Header_Id;
    //}

    var _SearchObject_Header_Info = new SearchObject_Header_Info();
    if (ViewBag.SearchHeader != null)
    {
        _SearchObject_Header_Info =  ViewBag.SearchHeader;
    }

    Lawer_Info_BL _Lawer_Info_BL = new Lawer_Info_BL();
    List<UserInfo> _lstLawer = _Lawer_Info_BL.Lawer_Info_GetAll();
}

<style>
    /*độ rộng tên cột title từng trang là khác nhau nên khai báo ở trang đó luôn*/
    .div-search-title > div {
        width: 200px;
    }
</style>
@*style="padding:5px 38px"*@

<div>
    <div class="divCover cls_form_title">
        <img src="~/Content/icons/info.png" />
        <div class="cls_form_header">
          Luật sư trả lời
        </div>
    </div>

    <div class="div-search-ad">
        <div class="div-search-title">
            <div>Trả lời<i class="redspan">(*)</i></div>
        </div>
        <div class="div-search-content">
            <div>
                <textarea maxlength="4000" rows="10" style="height:200px; width:100%" id="_txtResult">
                </textarea>
            </div>
        </div>
    </div>


    @Html.Partial("/Areas/Wiki/Views/WikiDoc/_PartialTaiLieuUpload.cshtml", new string[] { "WIKIADD_FILE_01", "File đính kèm 1" })

    @Html.Partial("/Areas/Wiki/Views/WikiDoc/_PartialTaiLieuUpload.cshtml", new string[] { "WIKIADD_FILE_02", "File đính kèm 2" })
     
    <div class="form-group">
        <div class="form-group-bottom">
            <input type="submit" class="btn-default" value="Trả lời" onclick="return doTraLoi()" />
        </div>
    </div>
</div>

<script>

    function doTraLoi() {
        if (validateAction()) {
            var formData = new FormData();
            collectObjectData(formData);
            nvsConfirm(null, "Bạn có chắc chắn muốn trả lời search này cho luật sư hay không?", function () {
                $.ajax({
                    url: '/quan-ly-search/tra-loi-search',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    traditional: true,
                    async: false,
                    headers: { "cache-control": "no-cache" },
                    success: function (data) {
                        if (data.success == "-1") {
                            //jError("Lỗi check lại kết nối tới server", "Lỗi");
                            jError("Lỗi check lại kết nối tới server");
                            return false;
                        }
                        else {
                            jAlert('Trả lời search cho luật sư mới thành công!', "THÔNG BÁO", function () {
                                window.location.href = "/home";
                                //CloseDivPopUp('divWrapperPopUpApp');
                                //Search_Application(1,1);
                            });
                        }
                    },
                    error: function (e) {
                        console.log(e);
                    }
                });
            });
        }
    }

    function validateAction() {
        var _txtResult = $("$_txtResult");
        if (_txtResult == null || _txtResult == "") {
            jError('Nội dung không được để trống!', "Lỗi", function () {
                _txtResult.focus();
            });
            return false;
        }

        return true;
    }

    function collectObjectData(formData) {
        formData.append('p_SearchObject_Header_Info.CONTENT', _Lawer_Id);
        formData.append('p_SearchObject_Header_Info.CASE_CODE', '@_SearchObject_Header_Info.CASE_CODE');
    }
</script>

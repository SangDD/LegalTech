@using ObjectInfos.ModuleTrademark
@using ObjectInfos
@using System.Linq;

@{
    List<AppDocumentOthersInfo> ListDocDesign = new List<AppDocumentOthersInfo>();
    List<AppDocumentOthersInfo> ListDocDesignLv2 = new List<AppDocumentOthersInfo>();
    if (ViewBag.ListDocDesign != null)
    {
        ListDocDesign = (List<AppDocumentOthersInfo>)ViewBag.ListDocDesign;
    }

    string listIDFileAtt = "";
    string styleTLK = "display:block";
    if (ListDocDesign.Count > 0)
    {
        styleTLK = "display:block";
        ListDocDesignLv2 = ListDocDesign.Where(m => m.IdRef != 0).ToList();
    }

    decimal _max_Model_Id = ListDocDesign.Count + 1;\
    int _index = 0;
}

<div class="div_full_100_area" id="divTreeContainerDocOther" style="@styleTLK">
    @*@Html.Partial("~/Areas/TradeMark/Views/Shared/_PartialTitle.cshtml", "Bộ hình ảnh")*@
    <div class="divCover cls_form_title">
        <div class="cls_form_header" style="margin: 0 !important;">
            Bộ hình ảnh
            <button title="Thêm phương án" onclick="funcTreeAddDocumentNew(1)"><i class="fa fa-plus-circle"></i></button>
        </div>
    </div>

    @foreach (AppDocumentOthersInfo item in ListDocDesign)
    {
        item.Model_Id = (_index + 1);

        if (item.IdRef == 0)
        {
            <div id="TreedivDocumentOther">
                <div meta-data="1">

                    @Html.Partial("~/Areas/IndustrialDesign/Views/Shared/_PartialTreeDocument_Edit_Child_0.cshtml", item)

                    @foreach (AppDocumentOthersInfo itemlv2 in ListDocDesignLv2)
                    {
                        if (item.ParentId == itemlv2.IdRef.ToString())
                        {
                            @Html.Partial("~/Areas/IndustrialDesign/Views/Shared/_PartialTreeDocument_Edit_Child_2.cshtml", item)
                        }
                    }
                </div>
            </div>
        }

        _index++;
    }

    <input type="hidden" id="TreeincreNo" value="@_max_Model_Id" />
</div>

<script>

    function funcTreeAddDocumentNew(_level) {
        try {

            var e = $("#TreeincreNo").val() / 1;
            e++;
            var pfileName = "pTreefileName" + e.toString();
            var txtDocument = "TreetxtTaiLieuKhac" + e.toString();
            var txtDocumentSoTrang = "Treetxttailieuanhsotrang" + e.toString();
            var txtDocumentGhiChu = "TreetxttailieuanhGhiChu" + e.toString();
            var txtMaxfile = "treetxtMaxfile" + e.toString();
            var divDocumnetNo = "treedivDocumnetNo" + e;

            var btnXoa = "treebtnXoa" + e;
            var btnTaiFile = "treebtnTaiFile" + e;
            var btnremoveFile = "treebtnRemove" + e;
            var _style = "";
            if (_level == 2) {
                _style = "padding-left:20px";
            }
            var _display = "";
            if (_level != 2) {
                _display = "display:none;";
            }
            var _refid = "0";
            var t = ' <div meta-data="' + e + '">  <div class="div-search-ad" id="' + divDocumnetNo + '"><div class="div-search-title" style="' + _style + '"> <div > @WebApps.Resources.Resource.lblTenTaiLieu :</div> </div>  <div class="div-search-content"> <div> <input type="text" class="clssListUploadIndusDesign" maxlength="200"  id = "' + txtDocument + '" meta-data2="1" meta-data="' + e + '"  placeholder="@WebApps.Resources.Resource.lblNhapTenTaiLieuDinhKem"> </div> </div>';
            t += '<div class="div-search-title"> <div>  Số trang</div> </div>  <div class="div-search-content"> <div>  <input type="text" style="width:90px"   maxlength="4" placeholder="Nhập số trang" id="' + txtDocumentSoTrang + '" /> </div> </div>';
            t += '<div class="div-search-title"> <div>  Ghi chú</div> </div>  <div class="div-search-content"> <div>  <input type="text"   maxlength="1000" placeholder="Nhập ghi chú" id="'+txtDocumentGhiChu+'" /> </div> </div>';
            t += '<div class="div-search-content"> <div> <div class="file-upload btn btn-primary" style="margin-left:2px;' + _display + '"> <span>@WebApps.Resources.Resource.lblTaiFile</span>' +
                ' <input type="file" onchange="return funcTreeChoiseFileDocOther(\'' + pfileName + '\', \'' + txtMaxfile + '\', \'' + txtDocument + '\', \'' + btnremoveFile + '\', \'' + _refid + '\');" name = "' + pfileName + '" id = "' + pfileName + '" class="upload fileuploadurl"  /> </div>' +
                '<input type="text" class="classMaxfile" id="' + txtMaxfile + '" readonly >' +
                '<button class="clssDisplaynone" id="' + btnremoveFile + '" onclick="TreeRemoveFileDocOther(\'' + txtDocument + '\', \'' + btnremoveFile + '\', \'' + txtMaxfile + '\')" style="width: 30px;margin-left:1px"><i class="fa fa-minus-circle"></i></button>' +
               '<button title="Thêm tài liệu cùng cấp" onclick="funcTreeAddSubDocumentNew(this)" style="width: 30px;margin-left:2px; height:30px"><i class="fa fa-plus-square"></i></button>' +
              '<i class="fa fa-check" id="i_' + pfileName + '" style="font-size:15px; color:green ;display:none;padding:5px; height:30px"></i> <button onclick="return funcTreeRemoveDocument(this,1)" id="' + btnXoa + '" style="width: 30px;margin-left:2px"><i class="fa fa-minus-circle"></i></button> </div></div></div></div>';
            $("#TreedivDocumentOther").append(t);
            $("#TreeincreNo").val(e);
            return t;
        } catch (e) {
            alert(e)
        }
    }

    function funcTreeAddSubDocumentNew(element) {
        try {
            var e = $("#TreeincreNo").val() / 1;
            e++;
            var pfileName = "pTreefileName" + e.toString();
            var txtDocument = "TreetxtTaiLieuKhac" + e.toString();
            var txtDocumentSoTrang = "Treetxttailieuanhsotrang" + e.toString();
            var txtDocumentGhiChu = "TreetxttailieuanhGhiChu" + e.toString();
            var txtMaxfile = "treetxtMaxfile" + e.toString();
            var divDocumnetNo = "treedivDocumnetNo" + e;
            var btnXoa = "treebtnXoa" + e;
            var btnTaiFile = "treebtnTaiFile" + e;
            var btnremoveFile = "treebtnRemove" + e;
            //var _style = "padding-left:20px";
            var _style = "margin-left: 20px;";

            var _display = "";
            var _refelemnt = $(element).parent().parent().parent().parent();
            var _refid = $(_refelemnt).attr('meta-data');
            var t = '<div class="div-search-ad" id="' + divDocumnetNo + '"><div class="div-search-title" style="' + _style + '"> <div style="width: 100px;"> @WebApps.Resources.Resource.lblTenTaiLieu :</div> </div>  <div class="div-search-content"> <div> <input type="text" class="clssListUploadIndusDesign" maxlength="200"  id = "' + txtDocument + '" meta-data2="2" meta-data="' + e + '"  placeholder="@WebApps.Resources.Resource.lblNhapTenTaiLieuDinhKem"> </div> </div>';
            t += '<div class="div-search-title"> <div>  Số trang</div> </div>  <div class="div-search-content"> <div>  <input type="text" style="width:90px"   maxlength="4" placeholder="Nhập số trang" id="' + txtDocumentSoTrang + '" /> </div> </div>';
            t += '<div class="div-search-title"> <div>  Ghi chú</div> </div>  <div class="div-search-content"> <div>  <input type="text"   maxlength="1000" placeholder="Nhập ghi chú" id="' + txtDocumentGhiChu + '"  /> </div> </div>';
            t += '<div class="div-search-content"> <div> <div class="file-upload btn btn-primary" style="margin-left:2px;' + _display + '"> <span>@WebApps.Resources.Resource.lblTaiFile</span>' +
                ' <input type="file" onchange="return funcTreeChoiseFileDocOther(\'' + pfileName + '\', \'' + txtMaxfile + '\', \'' + txtDocument + '\', \'' + btnremoveFile + '\', \'' + _refid + '\');" name = "' + pfileName + '" id = "' + pfileName + '" class="upload fileuploadurl"  /> </div>' +
                '<input type="text" class="classMaxfile" id="' + txtMaxfile + '" readonly >' +
              '<i class="fa fa-check" id="i_' + pfileName + '" style="font-size:15px; color:green ;display:none;padding:5px; height:30px"></i> <button onclick="return funcTreeRemoveDocument(this, 2)" id="' + btnXoa + '" style="width: 30px;margin-left:2px"><i class="fa fa-minus-circle"></i></button> </div></div></div>  ';
            $(element).parent().parent().parent().parent().append(t);
            $("#TreeincreNo").val(e);
            return t;
        } catch (e) {
            alert(e)
        }
    }
</script>

